<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎮 موقع الألعاب التعليمي 🎯</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 50px;
            animation: fadeInDown 1s ease-out;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }

        .game-card {
            background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
            cursor: pointer;
            animation: fadeInUp 0.8s ease-out;
        }

        .game-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            background: linear-gradient(145deg, rgba(255,255,255,0.2), rgba(255,255,255,0.1));
        }

        .game-card.focused {
            transform: translateY(-10px);
            box-shadow: 0 0 30px #FFD700;
            border: 2px solid #FFD700;
        }

        .game-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            display: block;
        }

        .game-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #FFD700;
        }

        .game-description {
            font-size: 1rem;
            opacity: 0.8;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .play-button {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Cairo', sans-serif;
        }

        .play-button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .features {
            background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .features h2 {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 30px;
            color: #FFD700;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .feature-item {
            text-align: center;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
        }

        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            display: block;
        }

        .controls {
            background: linear-gradient(145deg, rgba(0,255,0,0.1), rgba(0,200,0,0.05));
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }

        .controls h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #90EE90;
        }

        .control-keys {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .key {
            background: rgba(255,255,255,0.2);
            padding: 10px 15px;
            border-radius: 10px;
            font-weight: 600;
            border: 1px solid rgba(255,255,255,0.3);
        }

        .footer {
            text-align: center;
            padding: 30px;
            border-top: 1px solid rgba(255,255,255,0.2);
            margin-top: 50px;
        }

        .game-area {
            display: none;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px;
            margin-top: 30px;
            backdrop-filter: blur(10px);
        }

        .game-area.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        .back-button {
            background: linear-gradient(45deg, #FF4757, #FF3838);
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 20px;
            font-family: 'Cairo', sans-serif;
        }

        .chess-board {
            display: grid;
            grid-template-columns: repeat(8, 60px);
            grid-template-rows: repeat(8, 60px);
            gap: 2px;
            margin: 20px auto;
            border: 4px solid #8B4513;
            border-radius: 10px;
            background: #8B4513;
        }

        .chess-square {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .chess-square.light {
            background: #F0D9B5;
            color: #333;
        }

        .chess-square.dark {
            background: #B58863;
            color: #333;
        }

        .chess-square.selected {
            box-shadow: inset 0 0 0 3px #FFD700;
        }

        .chess-square.possible-move {
            box-shadow: inset 0 0 0 3px #FF4757;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .backgammon-point {
            border-radius: 0 0 50px 50px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 5px;
            min-height: 200px;
        }

        .backgammon-point:nth-child(n+14) {
            border-radius: 50px 50px 0 0;
            justify-content: flex-end;
        }

        .backgammon-point.selected {
            box-shadow: inset 0 0 0 3px #FFD700;
        }

        .backgammon-point.possible-move {
            box-shadow: inset 0 0 0 3px #FF4757;
        }

        .backgammon-piece {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin: 1px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8rem;
            border: 2px solid rgba(0,0,0,0.3);
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .backgammon-piece.white {
            background: linear-gradient(45deg, #FFFFFF, #F0F0F0);
            color: #333;
        }

        .backgammon-piece.black {
            background: linear-gradient(45deg, #333333, #111111);
            color: white;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .games-grid {
                grid-template-columns: 1fr;
            }
            
            .chess-board {
                grid-template-columns: repeat(8, 40px);
                grid-template-rows: repeat(8, 40px);
            }
            
            .chess-square {
                font-size: 1.5rem;
            }

            #backgammon-board {
                width: 100% !important;
                max-width: 600px;
                height: 400px !important;
            }
            
            .backgammon-piece {
                width: 20px;
                height: 20px;
                font-size: 0.6rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>🎮 موقع الألعاب التعليمي 🎯</h1>
            <p>ألعاب ذكية وممتعة للكبار والصغار - مع دعم كامل للريموت كنترول</p>
        </header>

        <div id="main-menu">
            <div class="games-grid">
                <div class="game-card" data-game="chess" tabindex="0">
                    <span class="game-icon">♔</span>
                    <h3 class="game-title">الشطرنج</h3>
                    <p class="game-description">لعبة الملوك والاستراتيجية مع ذكاء اصطناعي متقدم ودروس تعليمية شاملة</p>
                    <button class="play-button">ابدأ اللعب</button>
                </div>

                <div class="game-card" data-game="backgammon" tabindex="0">
                    <span class="game-icon">⚫</span>
                    <h3 class="game-title">الطاولة</h3>
                    <p class="game-description">اللعبة الشرقية الأصيلة مع محاكاة واقعية للنرد وذكاء اصطناعي ذكي</p>
                    <button class="play-button">ابدأ اللعب</button>
                </div>

                <div class="game-card" data-game="domino" tabindex="0">
                    <span class="game-icon">⚀</span>
                    <h3 class="game-title">الدومينو</h3>
                    <p class="game-description">لعبة التفكير والتخطيط مع 28 قطعة كاملة وذكاء اصطناعي متطور</p>
                    <button class="play-button">ابدأ اللعب</button>
                </div>

                <div class="game-card" data-game="spaceshooter" tabindex="0">
                    <span class="game-icon">🚀</span>
                    <h3 class="game-title">حرب النجوم</h3>
                    <p class="game-description">مغامرة فضائية مثيرة مناسبة للأطفال من 3 سنوات مع رسوميات جميلة</p>
                    <button class="play-button">ابدأ المغامرة</button>
                </div>

                <div class="game-card" data-game="carracing" tabindex="0">
                    <span class="game-icon">🏎️</span>
                    <h3 class="game-title">سباق السيارات</h3>
                    <p class="game-description">سرعة وإثارة على الطريق مع فيزياء واقعية وسهولة في التحكم</p>
                    <button class="play-button">ابدأ السباق</button>
                </div>

                <div class="game-card" data-game="coming-soon" tabindex="0">
                    <span class="game-icon">🎲</span>
                    <h3 class="game-title">المزيد قريباً</h3>
                    <p class="game-description">نعمل على إضافة المزيد من الألعاب التعليمية والممتعة</p>
                    <button class="play-button" disabled>قريباً</button>
                </div>
            </div>

            <div class="features">
                <h2>✨ ميزات خاصة ✨</h2>
                <div class="features-grid">
                    <div class="feature-item">
                        <span class="feature-icon">📺</span>
                        <h4>دعم التلفزيون الذكي</h4>
                        <p>العب بريموت التلفزيون بسهولة تامة</p>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">🤖</span>
                        <h4>ذكاء اصطناعي متقدم</h4>
                        <p>خصم ذكي يتحدى مهاراتك</p>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">🔊</span>
                        <h4>أصوات واقعية</h4>
                        <p>تأثيرات صوتية مميزة لكل لعبة</p>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">📚</span>
                        <h4>دروس تعليمية</h4>
                        <p>تعلم من الصفر حتى الاحتراف</p>
                    </div>
                </div>
            </div>

            <div class="controls">
                <h3>🎮 كيفية التحكم بالريموت</h3>
                <div class="control-keys">
                    <span class="key">⬅️➡️⬆️⬇️ الأسهم للتنقل</span>
                    <span class="key">✅ OK للاختيار</span>
                    <span class="key">🔙 Back للرجوع</span>
                    <span class="key">🏠 Home للقائمة الرئيسية</span>
                </div>
            </div>
        </div>

        <!-- منطقة الألعاب -->
        <div id="chess-game" class="game-area">
            <button class="back-button" onclick="showMainMenu()">🔙 العودة للقائمة الرئيسية</button>
            <h2 style="text-align: center; margin-bottom: 20px;">♔ لعبة الشطرنج ♛</h2>
            <div style="text-align: center; margin-bottom: 20px;">
                <button onclick="resetChess()" style="background: linear-gradient(45deg, #4ECDC4, #44A08D); border: none; padding: 10px 20px; border-radius: 20px; color: white; font-weight: 600; cursor: pointer; margin: 0 10px; font-family: 'Cairo', sans-serif;">🔄 لعبة جديدة</button>
                <button onclick="toggleChessMode()" style="background: linear-gradient(45deg, #FF6B6B, #4ECDC4); border: none; padding: 10px 20px; border-radius: 20px; color: white; font-weight: 600; cursor: pointer; margin: 0 10px; font-family: 'Cairo', sans-serif;">🤖 وضع اللعب</button>
                <button onclick="toggleChessLevel()" style="background: linear-gradient(45deg, #9C27B0, #673AB7); border: none; padding: 10px 20px; border-radius: 20px; color: white; font-weight: 600; cursor: pointer; margin: 0 10px; font-family: 'Cairo', sans-serif;">⚡ المستوى</button>
                <button onclick="chessTutorial.showTutorial()" style="background: linear-gradient(45deg, #FFD700, #FFA000); border: none; padding: 10px 20px; border-radius: 20px; color: white; font-weight: 600; cursor: pointer; margin: 0 10px; font-family: 'Cairo', sans-serif;">📚 الدليل التعليمي</button>
                <button onclick="toggleSound()" style="background: linear-gradient(45deg, #FFA726, #FF7043); border: none; padding: 10px 20px; border-radius: 20px; color: white; font-weight: 600; cursor: pointer; margin: 0 10px; font-family: 'Cairo', sans-serif;">🔊 الصوت</button>
            </div>
            <div class="chess-board" id="chess-board"></div>
            <div style="text-align: center; margin-top: 20px;">
                <p id="game-status" style="font-size: 1.2rem; font-weight: 600;">دور الأبيض</p>
            </div>

            <!-- منطقة النصائح والاقتراحات -->
            <div id="chess-hints-area" style="margin-top: 20px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 15px; min-height: 100px;">
                <h3 style="margin: 0 0 15px 0; color: #FFD700; font-size: 1.2rem; text-align: center;">💡 النصائح والاقتراحات</h3>
                <div id="chess-current-hint" style="margin-bottom: 15px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 10px; text-align: center; min-height: 40px; display: flex; align-items: center; justify-content: center;">
                    <p style="margin: 0; color: #4ECDC4;">اختر قطعة لرؤية النصائح والحركات المقترحة</p>
                </div>
                <div id="chess-suggestions" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                    <!-- الاقتراحات ستظهر هنا -->
                </div>
            </div>
        </div>

        <!-- واجهة لعبة الطاولة -->
        <div id="backgammon-game" class="game-area">
            <button class="back-button" onclick="showMainMenu()">🔙 العودة للقائمة الرئيسية</button>
            <h2 style="text-align: center; margin-bottom: 20px;">⚫ لعبة الطاولة ⚪</h2>
            
            <!-- أزرار التحكم -->
            <div style="text-align: center; margin-bottom: 20px;">
                <button onclick="resetBackgammon()" style="background: linear-gradient(45deg, #4ECDC4, #44A08D); border: none; padding: 10px 20px; border-radius: 20px; color: white; font-weight: 600; cursor: pointer; margin: 0 10px; font-family: 'Cairo', sans-serif;">🔄 لعبة جديدة</button>
                <button onclick="rollDiceBackgammon()" id="roll-dice-btn" style="background: linear-gradient(45deg, #FF6B6B, #4ECDC4); border: none; padding: 10px 20px; border-radius: 20px; color: white; font-weight: 600; cursor: pointer; margin: 0 10px; font-family: 'Cairo', sans-serif;">🎲 رمي النرد</button>
                <button onclick="toggleBackgammonMode()" style="background: linear-gradient(45deg, #FFA726, #FF7043); border: none; padding: 10px 20px; border-radius: 20px; color: white; font-weight: 600; cursor: pointer; margin: 0 10px; font-family: 'Cairo', sans-serif;">🤖 وضع اللعب</button>
                <button onclick="toggleBackgammonLevel()" style="background: linear-gradient(45deg, #9C27B0, #673AB7); border: none; padding: 10px 20px; border-radius: 20px; color: white; font-weight: 600; cursor: pointer; margin: 0 10px; font-family: 'Cairo', sans-serif;">⚡ المستوى</button>
                <button onclick="backgammonTutorial.showTutorial()" style="background: linear-gradient(45deg, #FFD700, #FFA000); border: none; padding: 10px 20px; border-radius: 20px; color: white; font-weight: 600; cursor: pointer; margin: 0 10px; font-family: 'Cairo', sans-serif;">📚 الدليل التعليمي</button>
            </div>

            <!-- معلومات اللعبة -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 15px;">
                <div style="text-align: center;">
                    <p style="margin: 0; font-size: 1rem; opacity: 0.8;">اللاعب الحالي</p>
                    <p id="backgammon-current-player" style="margin: 5px 0 0 0; font-size: 1.2rem; font-weight: 600;">الأبيض</p>
                </div>
                <div style="text-align: center;">
                    <p style="margin: 0; font-size: 1rem; opacity: 0.8;">النرد</p>
                    <div id="backgammon-dice" style="margin: 5px 0 0 0; font-size: 1.5rem;">🎲 🎲</div>
                </div>
                <div style="text-align: center;">
                    <p style="margin: 0; font-size: 1rem; opacity: 0.8;">وضع اللعب</p>
                    <p id="backgammon-mode" style="margin: 5px 0 0 0; font-size: 1rem; font-weight: 600;">ضد الكمبيوتر</p>
                </div>
                <div style="text-align: center;">
                    <p style="margin: 0; font-size: 1rem; opacity: 0.8;">المستوى</p>
                    <p id="backgammon-level" style="margin: 5px 0 0 0; font-size: 1rem; font-weight: 600;">متوسط</p>
                </div>
            </div>

            <!-- لوحة الطاولة -->
            <div style="display: flex; justify-content: center; margin-bottom: 20px;">
                <div id="backgammon-board" style="
                    width: 800px; 
                    height: 500px; 
                    background: linear-gradient(45deg, #8B4513, #A0522D);
                    border: 4px solid #654321;
                    border-radius: 15px;
                    position: relative;
                    display: grid;
                    grid-template-columns: repeat(12, 1fr);
                    grid-template-rows: 1fr 60px 1fr;
                    gap: 2px;
                    padding: 10px;
                ">
                    <!-- سيتم إنشاء النقاط ديناميكياً -->
                </div>
            </div>

            <!-- حالة اللعبة -->
            <div style="text-align: center; margin-top: 20px;">
                <p id="backgammon-status" style="font-size: 1.2rem; font-weight: 600;">اضغط على "رمي النرد" لبدء اللعب</p>
            </div>

            <!-- منطقة النصائح والاقتراحات -->
            <div id="backgammon-hints-area" style="margin-top: 20px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 15px; min-height: 100px;">
                <h3 style="margin: 0 0 15px 0; color: #FFD700; font-size: 1.2rem; text-align: center;">🎲 النصائح والاقتراحات</h3>
                <div id="backgammon-current-hint" style="margin-bottom: 15px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 10px; text-align: center; min-height: 40px; display: flex; align-items: center; justify-content: center;">
                    <p style="margin: 0; color: #F0D9B5;">ارم النرد واختر قطعة لرؤية النصائح والحركات المقترحة</p>
                </div>
                <div id="backgammon-suggestions" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                    <!-- الاقتراحات ستظهر هنا -->
                </div>
            </div>
        </div>

        <div id="other-games" class="game-area">
            <button class="back-button" onclick="showMainMenu()">🔙 العودة للقائمة الرئيسية</button>
            <h2 style="text-align: center; margin-bottom: 20px;" id="current-game-title">اللعبة</h2>
            <div style="text-align: center; padding: 50px;">
                <p style="font-size: 1.5rem; margin-bottom: 30px;">🚧 هذه اللعبة قيد التطوير 🚧</p>
                <p style="font-size: 1.2rem; opacity: 0.8;">سيتم إضافة المزيد من الألعاب قريباً مع جميع الميزات المتقدمة</p>
            </div>
        </div>

        <footer class="footer">
            <p>&copy; 2025 - برمجة وتطوير: محاسب أحمد مبروك</p>
            <p style="margin-top: 10px; opacity: 0.8;">موقع ألعاب تعليمي احترافي مع دعم كامل للتلفزيون الذكي والذكاء الاصطناعي</p>
        </footer>
    </div>

    <!-- تحميل محركات الألعاب المتقدمة -->
    <script src="chess-advanced.js"></script>
    <script src="backgammon-advanced.js"></script>
    <script src="chess-tutorial.js"></script>
    <script src="backgammon-tutorial.js"></script>
    
    <script>
        // متغيرات اللعبة
        let currentFocus = 0;
        let gameCards = [];
        let isRemoteMode = false;
        let soundEnabled = true;
        
        // محركات الألعاب
        let chessEngine = null;
        let backgammonEngine = null;

        // تهيئة اللعبة
        document.addEventListener('DOMContentLoaded', function() {
            gameCards = document.querySelectorAll('.game-card');
            setupRemoteControl();
            initializeGames();
            
            // إضافة مستمعي الأحداث للبطاقات
            gameCards.forEach((card, index) => {
                card.addEventListener('click', () => selectGame(card.dataset.game));
                card.addEventListener('focus', () => setFocus(index));
            });
        });

        // إعداد التحكم بالريموت
        function setupRemoteControl() {
            // كشف التلفزيون الذكي
            const userAgent = navigator.userAgent.toLowerCase();
            isRemoteMode = userAgent.includes('smart-tv') || 
                          userAgent.includes('tizen') || 
                          userAgent.includes('webos') || 
                          userAgent.includes('roku') ||
                          window.innerWidth >= 1920;

            document.addEventListener('keydown', handleKeyPress);
            
            // تفعيل وضع الريموت عند الضغط على أي سهم
            if (!isRemoteMode) {
                document.addEventListener('keydown', function enableRemote(e) {
                    if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                        isRemoteMode = true;
                        setFocus(0);
                        document.removeEventListener('keydown', enableRemote);
                    }
                }, { once: true });
            } else {
                setFocus(0);
            }
        }

        // التعامل مع ضغط المفاتيح
        function handleKeyPress(event) {
            if (!isRemoteMode) return;

            switch (event.key) {
                case 'ArrowUp':
                    event.preventDefault();
                    if (document.getElementById('main-menu').style.display !== 'none') {
                        moveFocus(-2); // صعود صفين في الشبكة
                    }
                    break;
                case 'ArrowDown':
                    event.preventDefault();
                    if (document.getElementById('main-menu').style.display !== 'none') {
                        moveFocus(2); // نزول صفين في الشبكة
                    }
                    break;
                case 'ArrowLeft':
                    event.preventDefault();
                    if (document.getElementById('main-menu').style.display !== 'none') {
                        moveFocus(-1);
                    }
                    break;
                case 'ArrowRight':
                    event.preventDefault();
                    if (document.getElementById('main-menu').style.display !== 'none') {
                        moveFocus(1);
                    }
                    break;
                case 'Enter':
                case ' ':
                    event.preventDefault();
                    if (document.getElementById('main-menu').style.display !== 'none') {
                        const focusedCard = gameCards[currentFocus];
                        if (focusedCard) {
                            selectGame(focusedCard.dataset.game);
                        }
                    }
                    break;
                case 'Escape':
                case 'Backspace':
                    event.preventDefault();
                    showMainMenu();
                    break;
            }
        }

        // تحريك التركيز
        function moveFocus(direction) {
            const newFocus = currentFocus + direction;
            if (newFocus >= 0 && newFocus < gameCards.length) {
                setFocus(newFocus);
            }
        }

        // تعيين التركيز
        function setFocus(index) {
            // إزالة التركيز من البطاقة الحالية
            gameCards.forEach(card => card.classList.remove('focused'));
            
            // تعيين التركيز الجديد
            currentFocus = index;
            if (gameCards[currentFocus]) {
                gameCards[currentFocus].classList.add('focused');
                gameCards[currentFocus].focus();
            }
        }

        // اختيار لعبة
        function selectGame(gameType) {
            playSound('select');
            
            document.getElementById('main-menu').style.display = 'none';
            
            if (gameType === 'chess') {
                document.getElementById('chess-game').classList.add('active');
                resetChess();
            } else if (gameType === 'backgammon') {
                document.getElementById('backgammon-game').classList.add('active');
                resetBackgammon();
            } else if (gameType === 'coming-soon') {
                alert('🎮 هذه اللعبة قيد التطوير وستكون متاحة قريباً!');
                showMainMenu();
            } else {
                document.getElementById('current-game-title').textContent = getGameTitle(gameType);
                document.getElementById('other-games').classList.add('active');
            }
        }

        // الحصول على عنوان اللعبة
        function getGameTitle(gameType) {
            const titles = {
                'backgammon': '⚫ الطاولة ⚪',
                'domino': '⚀ الدومينو ⚅',
                'spaceshooter': '🚀 حرب النجوم 🌟',
                'carracing': '🏎️ سباق السيارات 🏁'
            };
            return titles[gameType] || 'اللعبة';
        }

        // إظهار القائمة الرئيسية
        function showMainMenu() {
            document.querySelectorAll('.game-area').forEach(area => {
                area.classList.remove('active');
            });
            document.getElementById('main-menu').style.display = 'block';
            
            if (isRemoteMode) {
                setFocus(0);
            }
        }

        // تشغيل الصوت
        function playSound(type) {
            if (!soundEnabled) return;
            
            // محاكاة الأصوات بـ Web Audio API
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            switch (type) {
                case 'select':
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    break;
                case 'move':
                    oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                    break;
                case 'capture':
                    oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                    break;
            }
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.1);
        }

        // تبديل الصوت
        function toggleSound() {
            soundEnabled = !soundEnabled;
            playSound('select');
            alert(soundEnabled ? '🔊 تم تشغيل الصوت' : '🔇 تم إيقاف الصوت');
        }

        // === تهيئة الألعاب ===

        function initializeGames() {
            chessEngine = new ChessEngine();
            backgammonEngine = new BackgammonEngine();
            renderChessBoard();
            renderBackgammonBoard();
        }

        // === وظائف الشطرنج المتقدمة ===

        function renderChessBoard() {
            const boardElement = document.getElementById('chess-board');
            boardElement.innerHTML = '';
            
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const square = document.createElement('div');
                    square.className = `chess-square ${(row + col) % 2 === 0 ? 'light' : 'dark'}`;
                    
                    const piece = chessEngine.board[row][col];
                    square.textContent = piece ? piece.symbol : '';
                    square.onclick = () => handleChessSquareClick(row, col);
                    
                    if (chessEngine.selectedSquare && 
                        chessEngine.selectedSquare[0] === row && 
                        chessEngine.selectedSquare[1] === col) {
                        square.classList.add('selected');
                    }
                    
                    // إظهار الحركات الممكنة
                    if (chessEngine.selectedSquare) {
                        const possibleMoves = chessEngine.getPossibleMoves(
                            chessEngine.selectedSquare[0], 
                            chessEngine.selectedSquare[1]
                        );
                        if (possibleMoves.some(move => move.row === row && move.col === col)) {
                            square.classList.add('possible-move');
                        }
                    }
                    
                    boardElement.appendChild(square);
                }
            }
            
            updateChessStatus();
        }

        function handleChessSquareClick(row, col) {
            const piece = chessEngine.board[row][col];
            
            if (chessEngine.selectedSquare) {
                const [selectedRow, selectedCol] = chessEngine.selectedSquare;
                
                if (row === selectedRow && col === selectedCol) {
                    chessEngine.selectedSquare = null;
                } else {
                    const possibleMoves = chessEngine.getPossibleMoves(selectedRow, selectedCol);
                    const validMove = possibleMoves.find(move => move.row === row && move.col === col);
                    
                    if (validMove) {
                        const move = chessEngine.makeMove(selectedRow, selectedCol, row, col);
                        
                        if (move.captured) {
                            playSound('capture');
                        } else {
                            playSound('move');
                        }
                        
                        // إذا كان وضع الكمبيوتر وانتهى دور اللاعب
                        if (chessEngine.gameMode === 'computer' && 
                            !chessEngine.isWhiteTurn && 
                            chessEngine.gameStatus === 'playing') {
                            setTimeout(async () => {
                                const aiMove = await chessEngine.makeAIMove();
                                if (aiMove) {
                                    playSound('move');
                                    renderChessBoard();
                                    updateChessHints();
                                }
                            }, 500);
                        }
                    } else if (piece && piece.color === (chessEngine.isWhiteTurn ? 'white' : 'black')) {
                        chessEngine.selectedSquare = [row, col];
                    } else {
                        chessEngine.selectedSquare = null;
                    }
                }
            } else if (piece && piece.color === (chessEngine.isWhiteTurn ? 'white' : 'black')) {
                chessEngine.selectedSquare = [row, col];
            }
            
            renderChessBoard();
            updateChessHints();
        }

        function updateChessHints() {
            const hintElement = document.getElementById('chess-current-hint');
            const suggestionsElement = document.getElementById('chess-suggestions');
            
            if (!hintElement || !suggestionsElement) return;
            
            // عرض النصيحة الحالية
            const hint = chessTutorial.getSmartHint(chessEngine, chessEngine.selectedSquare);
            if (hint) {
                hintElement.innerHTML = `<p style="margin: 0; color: #4ECDC4;">${hint}</p>`;
            } else {
                hintElement.innerHTML = `<p style="margin: 0; color: #4ECDC4;">اختر قطعة لرؤية النصائح والحركات المقترحة</p>`;
            }
            
            // عرض الاقتراحات
            if (chessEngine.selectedSquare) {
                const suggestions = chessTutorial.getSuggestedMoves(chessEngine, chessEngine.selectedSquare);
                
                suggestionsElement.innerHTML = suggestions.map(suggestion => `
                    <div onclick="makeChessSuggestedMove(${suggestion.move.row}, ${suggestion.move.col})" style="
                        background: rgba(255,255,255,0.1);
                        border-radius: 10px;
                        padding: 10px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        border: 1px solid rgba(255,255,255,0.2);
                    " onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                        <div style="color: #FFD700; font-weight: 600; margin-bottom: 5px;">
                            ${String.fromCharCode(97 + chessEngine.selectedSquare[1])}${8 - chessEngine.selectedSquare[0]} → ${String.fromCharCode(97 + suggestion.move.col)}${8 - suggestion.move.row}
                        </div>
                        <div style="color: #4ECDC4; font-size: 0.9rem;">
                            ${suggestion.reason}
                        </div>
                        <div style="color: #FFA726; font-size: 0.8rem; margin-top: 5px;">
                            أولوية: ${suggestion.priority}
                        </div>
                    </div>
                `).join('');
            } else {
                suggestionsElement.innerHTML = '';
            }
        }

        function makeChessSuggestedMove(toRow, toCol) {
            if (chessEngine.selectedSquare) {
                handleChessSquareClick(toRow, toCol);
            }
        }

        function updateChessStatus() {
            const statusElement = document.getElementById('game-status');
            const currentPlayer = chessEngine.isWhiteTurn ? 'الأبيض' : 'الأسود';
            
            switch (chessEngine.gameStatus) {
                case 'playing':
                    statusElement.textContent = `دور ${currentPlayer}`;
                    break;
                case 'check':
                    statusElement.textContent = `كش! دور ${currentPlayer}`;
                    break;
                case 'checkmate':
                    const winner = chessEngine.isWhiteTurn ? 'الأسود' : 'الأبيض';
                    statusElement.textContent = `كش مات! فاز ${winner}`;
                    break;
                case 'stalemate':
                    statusElement.textContent = 'تعادل - لا توجد حركات صالحة';
                    break;
                case 'draw-50-moves':
                    statusElement.textContent = 'تعادل - قانون الـ50 حركة';
                    break;
                case 'draw-insufficient-material':
                    statusElement.textContent = 'تعادل - قطع غير كافية';
                    break;
            }
        }

        function resetChess() {
            chessEngine.reset();
            renderChessBoard();
            updateChessHints();
            playSound('select');
        }

        function toggleChessMode() {
            chessEngine.gameMode = chessEngine.gameMode === 'computer' ? 'friend' : 'computer';
            const modeText = chessEngine.gameMode === 'computer' ? 'ضد الكمبيوتر' : 'لاعبين';
            alert(`🎮 تم التبديل إلى وضع: ${modeText}`);
        }

        function toggleChessLevel() {
            const levels = ['easy', 'medium', 'hard', 'expert'];
            const levelNames = ['سهل', 'متوسط', 'صعب', 'خبير'];
            const currentIndex = levels.indexOf(chessEngine.aiLevel);
            const nextIndex = (currentIndex + 1) % levels.length;
            
            chessEngine.aiLevel = levels[nextIndex];
            alert(`⚡ تم تغيير المستوى إلى: ${levelNames[nextIndex]}`);
        }

        // === وظائف الطاولة المتقدمة ===

        function renderBackgammonBoard() {
            const boardElement = document.getElementById('backgammon-board');
            boardElement.innerHTML = '';
            
            // إنشاء النقاط العلوية (13-24)
            for (let point = 13; point <= 24; point++) {
                const pointElement = document.createElement('div');
                pointElement.className = 'backgammon-point';
                pointElement.dataset.point = point;
                pointElement.style.background = (point % 2 === 1) ? '#F0D9B5' : '#B58863';
                pointElement.style.gridRow = '1';
                pointElement.onclick = () => handleBackgammonPointClick(point);
                
                renderBackgammonPieces(pointElement, point);
                boardElement.appendChild(pointElement);
            }
            
            // الشريط الأوسط
            const middleBar = document.createElement('div');
            middleBar.style.gridRow = '2';
            middleBar.style.gridColumn = '1 / -1';
            middleBar.style.background = '#654321';
            middleBar.style.display = 'flex';
            middleBar.style.justifyContent = 'space-between';
            middleBar.style.alignItems = 'center';
            middleBar.style.padding = '0 20px';
            middleBar.innerHTML = `
                <div id="captured-white" style="color: white; font-weight: 600;">قطع بيضاء مأسورة: ${backgammonEngine.board[25].pieces}</div>
                <div id="captured-black" style="color: white; font-weight: 600;">قطع سوداء مأسورة: ${backgammonEngine.board[26].pieces}</div>
            `;
            boardElement.appendChild(middleBar);
            
            // إنشاء النقاط السفلية (12-1)
            for (let point = 12; point >= 1; point--) {
                const pointElement = document.createElement('div');
                pointElement.className = 'backgammon-point';
                pointElement.dataset.point = point;
                pointElement.style.background = (point % 2 === 0) ? '#F0D9B5' : '#B58863';
                pointElement.style.gridRow = '3';
                pointElement.style.borderRadius = '50px 50px 0 0';
                pointElement.style.justifyContent = 'flex-end';
                pointElement.onclick = () => handleBackgammonPointClick(point);
                
                renderBackgammonPieces(pointElement, point);
                boardElement.appendChild(pointElement);
            }
            
            updateBackgammonStatus();
        }

        function renderBackgammonPieces(pointElement, pointNumber) {
            const pointData = backgammonEngine.board[pointNumber];
            pointElement.innerHTML = '';
            
            if (pointData.pieces > 0) {
                for (let i = 0; i < Math.min(pointData.pieces, 5); i++) {
                    const piece = document.createElement('div');
                    piece.className = `backgammon-piece ${pointData.color}`;
                    piece.textContent = i === 4 && pointData.pieces > 5 ? `+${pointData.pieces - 4}` : '';
                    pointElement.appendChild(piece);
                }
            }
        }

        function handleBackgammonPointClick(pointNumber) {
            if (backgammonEngine.availableMoves.length === 0) {
                alert('🎲 يجب رمي النرد أولاً!');
                return;
            }
            
            const possibleMoves = backgammonEngine.getPossibleMoves(pointNumber);
            
            if (possibleMoves.length === 0) {
                alert('❌ لا توجد حركات صالحة من هذه النقطة');
                return;
            }
            
            if (possibleMoves.length === 1) {
                // حركة واحدة فقط
                const move = possibleMoves[0];
                backgammonEngine.makeMove(move.from, move.to, move.dice);
                playSound('move');
                renderBackgammonBoard();
                updateBackgammonHints();
                
                // إذا انتهت الحركات، تحقق من دور الكمبيوتر
                if (backgammonEngine.availableMoves.length === 0 && 
                    backgammonEngine.gameMode === 'computer' && 
                    !backgammonEngine.isWhiteTurn) {
                    setTimeout(async () => {
                        const aiMoves = await backgammonEngine.makeAIMove();
                        if (aiMoves && aiMoves.length > 0) {
                            playSound('move');
                            renderBackgammonBoard();
                            updateBackgammonHints();
                        }
                    }, 1000);
                }
            } else {
                // عدة حركات ممكنة - عرض الاقتراحات
                showBackgammonSuggestions(pointNumber, possibleMoves);
            }
        }

        function showBackgammonSuggestions(pointNumber, possibleMoves) {
            const suggestions = backgammonTutorial.getSuggestedMoves(
                backgammonEngine, 
                pointNumber, 
                backgammonEngine.availableMoves
            );
            
            const suggestionsElement = document.getElementById('backgammon-suggestions');
            suggestionsElement.innerHTML = suggestions.map(suggestion => `
                <div onclick="makeBackgammonSuggestedMove(${suggestion.from}, ${suggestion.to}, ${suggestion.dice})" style="
                    background: rgba(255,255,255,0.1);
                    border-radius: 10px;
                    padding: 10px;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    border: 1px solid rgba(255,255,255,0.2);
                " onmouseover="this.style.background='rgba(255,255,255,0.2)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                    <div style="color: #FFD700; font-weight: 600; margin-bottom: 5px;">
                        النقطة ${suggestion.from} → النقطة ${suggestion.to}
                    </div>
                    <div style="color: #F0D9B5; font-size: 0.9rem;">
                        ${suggestion.reason}
                    </div>
                    <div style="color: #FFA726; font-size: 0.8rem; margin-top: 5px;">
                        النرد: ${suggestion.dice} | أولوية: ${suggestion.priority}
                    </div>
                </div>
            `).join('');
        }

        function makeBackgammonSuggestedMove(from, to, dice) {
            backgammonEngine.makeMove(from, to, dice);
            playSound('move');
            renderBackgammonBoard();
            updateBackgammonHints();
        }

        function updateBackgammonHints() {
            const hintElement = document.getElementById('backgammon-current-hint');
            const suggestionsElement = document.getElementById('backgammon-suggestions');
            
            if (!hintElement || !suggestionsElement) return;
            
            // عرض النصيحة الحالية
            const hint = backgammonTutorial.getSmartHint(backgammonEngine, backgammonEngine.availableMoves);
            if (hint) {
                hintElement.innerHTML = `<p style="margin: 0; color: #F0D9B5;">${hint}</p>`;
            } else {
                hintElement.innerHTML = `<p style="margin: 0; color: #F0D9B5;">ارم النرد واختر قطعة لرؤية النصائح والحركات المقترحة</p>`;
            }
            
            // مسح الاقتراحات إذا لم تعد هناك حركات متاحة
            if (backgammonEngine.availableMoves.length === 0) {
                suggestionsElement.innerHTML = '';
            }
        }

        function rollDiceBackgammon() {
            if (backgammonEngine.availableMoves.length > 0) {
                alert('⚠️ يجب إنهاء الحركات الحالية أولاً');
                return;
            }
            
            const dice = backgammonEngine.rollDice();
            document.getElementById('backgammon-dice').textContent = `🎲 ${dice[0]} - ${dice[1]} 🎲`;
            playSound('move');
            renderBackgammonBoard();
            updateBackgammonHints();
        }

        function updateBackgammonStatus() {
            const statusElement = document.getElementById('backgammon-status');
            const currentPlayer = backgammonEngine.isWhiteTurn ? 'الأبيض' : 'الأسود';
            
            if (backgammonEngine.gameStatus === 'playing') {
                if (backgammonEngine.availableMoves.length > 0) {
                    statusElement.textContent = `دور ${currentPlayer} - اختر قطعة للحركة`;
                } else {
                    statusElement.textContent = `دور ${currentPlayer} - اضغط "رمي النرد"`;
                }
            } else if (backgammonEngine.gameStatus.includes('wins')) {
                const winner = backgammonEngine.gameStatus.includes('white') ? 'الأبيض' : 'الأسود';
                statusElement.textContent = `🎉 فاز ${winner}! قيمة اللعبة: ${backgammonEngine.gameValue}`;
            }
            
            document.getElementById('backgammon-current-player').textContent = currentPlayer;
        }

        function resetBackgammon() {
            backgammonEngine.reset();
            document.getElementById('backgammon-dice').textContent = '🎲 🎲';
            renderBackgammonBoard();
            updateBackgammonHints();
            playSound('select');
        }

        function toggleBackgammonMode() {
            backgammonEngine.gameMode = backgammonEngine.gameMode === 'computer' ? 'friend' : 'computer';
            const modeText = backgammonEngine.gameMode === 'computer' ? 'ضد الكمبيوتر' : 'لاعبين';
            document.getElementById('backgammon-mode').textContent = modeText;
            alert(`🎮 تم التبديل إلى وضع: ${modeText}`);
        }

        function toggleBackgammonLevel() {
            const levels = ['easy', 'medium', 'hard', 'expert'];
            const levelNames = ['سهل', 'متوسط', 'صعب', 'خبير'];
            const currentIndex = levels.indexOf(backgammonEngine.aiLevel);
            const nextIndex = (currentIndex + 1) % levels.length;
            
            backgammonEngine.aiLevel = levels[nextIndex];
            document.getElementById('backgammon-level').textContent = levelNames[nextIndex];
            alert(`⚡ تم تغيير المستوى إلى: ${levelNames[nextIndex]}`);
        }
    </script>
</body>
</html>
